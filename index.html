<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bariatric Pal</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap"
    rel="stylesheet">

  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #e3f2fd, #e8f5e9);
      --card-bg: rgba(255, 255, 255, 0.95);
      --accent: #4f8cff;
      --accent-soft: #e3edff;
      --accent-strong: #2f5fd6;
      --text-main: #1f2933;
      --text-muted: #6b7b8c;
      --danger: #f05454;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 14px 30px rgba(15, 23, 42, 0.12);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-gradient);
      display: flex;
      justify-content: center;
      padding: 24px 16px;
      color: var(--text-main);
    }

    .app-container {
      width: 100%;
      max-width: 750px;
      background: transparent;
    }

    .app-header {
      text-align: center;
      margin-bottom: 18px;
    }

    .tagline {
      font-size: 0.95rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    h1 {
      font-size: 1.7rem;
      letter-spacing: 0.02em;
      margin: 0;
    }

    .chip-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .chip {
      font-size: 0.78rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.7);
      color: var(--text-muted);
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 18px 18px 20px;
      margin-bottom: 18px;
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(8px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 12px;
      gap: 8px;
    }

    .card-title {
      font-size: 1.05rem;
      font-weight: 600;
    }

    .card-subtitle {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    label {
      display: block;
      margin-top: 10px;
      font-size: 0.88rem;
      font-weight: 500;
      color: var(--text-main);
    }

    input[type="number"],
    input[type="date"],
    textarea {
      width: 100%;
      margin-top: 4px;
      padding: 9px 10px;
      border-radius: var(--radius-md);
      border: 1px solid #d2dde8;
      font-size: 0.92rem;
      font-family: inherit;
      outline: none;
      background-color: #f9fbff;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background-color 0.15s ease;
    }

    input[type="number"]:focus,
    input[type="date"]:focus,
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
      background-color: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    .inline-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .inline-row .field {
      flex: 1 1 0;
      min-width: 120px;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 12px;
      padding: 8px 10px;
      border-radius: var(--radius-md);
      background-color: #f5f7fb;
    }

    .checkbox-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--accent);
    }

    .checkbox-row label {
      margin: 0;
      font-weight: 500;
    }

    .button-row {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    button {
      padding: 9px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      letter-spacing: 0.01em;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background-color 0.15s ease, opacity 0.12s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(255, 255, 255, 0.8);
    }

    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    #saveBtn {
      background: var(--accent);
      color: #ffffff;
      box-shadow: 0 10px 18px rgba(79, 140, 255, 0.35);
    }

    #saveBtn:hover {
      background: var(--accent-strong);
    }

    #clearBtn {
      background: #ffffff;
      color: var(--danger);
      border: 1px solid #ffc9c9;
    }

    #clearBtn:hover {
      background: #ffecec;
    }

    .hint {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 10px;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 6px;
      margin-bottom: 8px;
    }

    .summary-item {
      padding: 10px;
      border-radius: var(--radius-md);
      background-color: #f6f8ff;
      font-size: 0.86rem;
    }

    .summary-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .summary-value {
      font-weight: 600;
    }

    .notes-box {
      margin-top: 10px;
      padding: 10px;
      border-radius: var(--radius-md);
      background-color: #f8fafc;
      font-size: 0.86rem;
      color: var(--text-main);
      border: 1px dashed #d5e0ec;
    }

    .notes-empty {
      font-style: italic;
      color: var(--text-muted);
    }

    /* Tabs / pages */
    .nav-tabs {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 16px;
      margin-bottom: 16px;
    }

    .nav-tab {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 999px;
      border: 1px solid #d2dde8;
      padding: 6px 12px;
      font-size: 0.85rem;
      cursor: pointer;
      font-family: inherit;
    }

    .nav-tab.active {
      background: var(--accent);
      color: #ffffff;
      border-color: var(--accent);
    }

    .page {
      margin-top: 8px;
    }

    .page.hidden {
      display: none;
    }

    .affirmation-list {
      margin: 0;
      padding-left: 20px;
      font-size: 0.9rem;
    }

    .affirmation-list li {
      margin-bottom: 6px;
    }

    .chart-title {
      margin-top: 16px;
      margin-bottom: 6px;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    /* Recommended products grid */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }

    .product-card {
      background-color: #f6f8ff;
      border-radius: var(--radius-md);
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .product-name {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .product-tagline {
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .product-link {
      font-size: 0.85rem;
      color: var(--accent-strong);
      text-decoration: none;
      margin-top: 4px;
    }

    .product-link:hover {
      text-decoration: underline;
    }

    @media (max-width: 480px) {
      body {
        padding: 16px 10px;
      }

      h1 {
        font-size: 1.45rem;
      }

      .card {
        padding: 14px 14px 17px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <h1>Bariatric Pal</h1>
      <p class="tagline">Gentle reminders to fuel, move, and heal after VSG.</p>
      <div class="chip-row">
        <span class="chip">üíß Hydration</span>
        <span class="chip">üçó Protein</span>
        <span class="chip">üíä Medication</span>
        <span class="chip">üö∂ Movement</span>
        <span class="chip">‚öñÔ∏è Weight</span>
      </div>
    </header>

    <nav class="nav-tabs">
      <button class="nav-tab active" data-target="homePage">Home</button>
      <button class="nav-tab" data-target="quotePage">Quote of the Day</button>
      <button class="nav-tab" data-target="affirmationsPage">Affirmations</button>
      <button class="nav-tab" data-target="productsPage">Recommended Products</button>
      <button class="nav-tab" data-target="progressPage">Progress Report</button>
    </nav>

    <!-- HOME PAGE -->
    <div id="homePage" class="page">
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Today‚Äôs Checklist</div>
            <div class="card-subtitle">Track your VSG habits one day at a time.</div>
          </div>
        </div>

        <label for="date">Date</label>
        <input type="date" id="date">

        <div class="inline-row">
          <div class="field">
            <label for="water">Water (oz)</label>
            <input type="number" id="water" min="0" placeholder="e.g., 64">
          </div>
          <div class="field">
            <label for="protein">Protein (g)</label>
            <input type="number" id="protein" min="0" placeholder="e.g., 60">
          </div>
        </div>

        <div class="inline-row">
          <div class="field">
            <label for="weight">Weight (lbs)</label>
            <input type="number" id="weight" min="0" placeholder="e.g., 260">
          </div>
          <div class="field">
            <label for="walk">Walk (minutes)</label>
            <input type="number" id="walk" min="0" placeholder="e.g., 20">
          </div>
        </div>

        <div class="checkbox-row">
          <input type="checkbox" id="meds">
          <label for="meds">I took all my prescribed medicine today</label>
        </div>

        <label for="notes">Notes (how you feel, any wins or struggles)</label>
        <textarea id="notes" placeholder="e.g., Felt sore but proud I hit my water goal."></textarea>

        <div class="button-row">
          <button id="saveBtn">üíæ Save Day</button>
          <button id="clearBtn">üóë Clear This Day</button>
          <button id="goToProgressBtn" type="button">üìà View Progress Report</button>
        </div>

        <p class="hint">
          Your data is stored privately in this browser (using localStorage).
          If you change devices or clear browser data, you‚Äôll lose these logs.
        </p>
      </section>

      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Daily Summary</div>
            <div class="card-subtitle">A snapshot of how you‚Äôre doing today.</div>
          </div>
        </div>
        <div id="summary">
          <p class="notes-empty">No data saved for this date yet.</p>
        </div>
      </section>
    </div>

    <!-- QUOTE PAGE -->
    <div id="quotePage" class="page hidden">
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Quote of the Day</div>
            <div class="card-subtitle" id="quoteDate"></div>
          </div>
        </div>
        <p id="quoteText" style="font-size: 1rem; line-height: 1.6; text-align: center; margin: 12px 0;"></p>
        <p class="hint" style="text-align:center;">
          A fresh reminder to keep going on your journey.
        </p>
      </section>
    </div>

    <!-- AFFIRMATIONS PAGE -->
    <div id="affirmationsPage" class="page hidden">
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Affirmations</div>
            <div class="card-subtitle">Speak these over yourself today.</div>
          </div>
        </div>
        <ul class="affirmation-list">
          <li>I am healing a little more every day.</li>
          <li>I deserve to feel healthy and energetic.</li>
          <li>I am patient with my body and my progress.</li>
          <li>Small choices are creating a big change.</li>
          <li>I am proud of myself for choosing this path.</li>
        </ul>
      </section>
    </div>

    <!-- RECOMMENDED PRODUCTS PAGE -->
    <div id="productsPage" class="page hidden">
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Recommended Products</div>
            <div class="card-subtitle">Tools and treats that support your journey.</div>
          </div>
        </div>

        <div class="product-grid" id="productGrid">
          <!-- 1: Fruit Punch -->
          <div class="product-card">
            <div class="product-name">SEEQ Clear Whey ‚Äì Fruit Punch</div>
            <div class="product-tagline">
              Juice-like fruit punch flavor that doesn‚Äôt feel milky or heavy.
            </div>
            <a href="https://amzn.to/4iqLU7M"
               class="product-link"
               target="_blank"
               rel="noopener noreferrer">
              View on Amazon
            </a>
          </div>

          <!-- 2: Strawberry Lemonade -->
          <div class="product-card">
            <div class="product-name">SEEQ Clear Whey ‚Äì Strawberry Lemonade</div>
            <div class="product-tagline">
              Light, juice-style protein with a bright strawberry lemonade flavor.
            </div>
            <a href="https://amzn.to/4ajrIm7"
               class="product-link"
               target="_blank"
               rel="noopener noreferrer">
              View on Amazon
            </a>
          </div>

          <!-- 3: Peach Tea -->
          <div class="product-card">
            <div class="product-name">SEEQ Clear Whey ‚Äì Peach Tea</div>
            <div class="product-tagline">
              Peach tea taste so smooth it barely feels like a ‚Äúprotein shake.‚Äù
            </div>
            <a href="https://amzn.to/48bQfGY"
               class="product-link"
               target="_blank"
               rel="noopener noreferrer">
              View on Amazon
            </a>
          </div>

          <!-- 4: Javvy Coffee -->
          <div class="product-card">
            <div class="product-name">Javvy Caramel Protein Iced Coffee</div>
            <div class="product-tagline">
              Coffee + protein in one ‚Äî caramel flavor with no added sugar.
            </div>
            <a href="https://amzn.to/4im1wcw"
               class="product-link"
               target="_blank"
               rel="noopener noreferrer">
              View on Amazon
            </a>
          </div>

          <!-- 5: Skinny Syrup -->
          <div class="product-card">
            <div class="product-name">Jordan‚Äôs Skinny Mixes ‚Äì Sugar Free Vanilla Syrup</div>
            <div class="product-tagline">
              Zero-calorie vanilla syrup to sweeten coffee or protein without extra carbs.
            </div>
            <a href="https://amzn.to/4opdXWq"
               class="product-link"
               target="_blank"
               rel="noopener noreferrer">
              View on Amazon
            </a>
          </div>
        </div>

        <p class="hint">
          You can edit these names, descriptions, or links anytime in the HTML.
        </p>
      </section>
    </div>

    <!-- PROGRESS REPORT PAGE -->
    <div id="progressPage" class="page hidden">
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Progress Report</div>
            <div class="card-subtitle">Your trends at a glance.</div>
          </div>
        </div>

        <p class="hint">
          These charts use the values you log on the Home page.
        </p>

        <h4 class="chart-title">Weight (lbs)</h4>
        <canvas id="weightChart" height="140"></canvas>

        <h4 class="chart-title">Water (oz)</h4>
        <canvas id="waterChart" height="120"></canvas>

        <h4 class="chart-title">Protein (g)</h4>
        <canvas id="proteinChart" height="120"></canvas>

        <h4 class="chart-title">Walk (minutes)</h4>
        <canvas id="walkChart" height="120"></canvas>

        <p id="noDataMsg" class="notes-empty" style="text-align:center; margin-top: 8px; display:none;">
          No data yet. Save a few days on the Home page to see your progress.
        </p>

        <div class="button-row">
          <button id="downloadJsonBtn" type="button">‚¨áÔ∏è Download My Data (PDF)</button>
        </div>
      </section>
    </div>
  </div>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF for PDF downloads -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script>
    const STORAGE_KEY = "bariatricPalData";

    const dateInput = document.getElementById("date");
    const waterInput = document.getElementById("water");
    const proteinInput = document.getElementById("protein");
    const weightInput = document.getElementById("weight");
    const walkInput = document.getElementById("walk");
    const medsInput = document.getElementById("meds");
    const notesInput = document.getElementById("notes");

    const saveBtn = document.getElementById("saveBtn");
    const clearBtn = document.getElementById("clearBtn");
    const goToProgressBtn = document.getElementById("goToProgressBtn");
    const downloadJsonBtn = document.getElementById("downloadJsonBtn");

    const summaryDiv = document.getElementById("summary");
    const navTabs = document.querySelectorAll(".nav-tab");
    const pages = document.querySelectorAll(".page");
    const quoteText = document.getElementById("quoteText");
    const quoteDate = document.getElementById("quoteDate");
    const noDataMsg = document.getElementById("noDataMsg");

    let weightChart, waterChart, proteinChart, walkChart;

    function getTodayString() {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, "0");
      const day = String(today.getDate()).padStart(2, "0");
      return `${year}-${month}-${day}`;
    }

    function loadAllData() {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (!stored) return {};
      try {
        return JSON.parse(stored);
      } catch {
        return {};
      }
    }

    function saveAllData(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function loadDataForDate(dateStr) {
      const allData = loadAllData();
      const dayData = allData[dateStr];

      if (dayData) {
        waterInput.value = dayData.water ?? "";
        proteinInput.value = dayData.protein ?? "";
        weightInput.value = dayData.weight ?? "";
        walkInput.value = dayData.walk ?? "";
        medsInput.checked = !!dayData.meds;
        notesInput.value = dayData.notes ?? "";
        updateSummary(dayData);
      } else {
        waterInput.value = "";
        proteinInput.value = "";
        weightInput.value = "";
        walkInput.value = "";
        medsInput.checked = false;
        notesInput.value = "";
        summaryDiv.innerHTML = '<p class="notes-empty">No data saved for this date yet.</p>';
      }
    }

    function updateSummary(dayData) {
      const medsText = dayData.meds ? "‚úÖ Took medicine" : "‚ö†Ô∏è Medicine not logged";

      summaryDiv.innerHTML = `
        <div class="summary-grid">
          <div class="summary-item">
            <div class="summary-label">Water</div>
            <div class="summary-value">${dayData.water || 0} oz</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Protein</div>
            <div class="summary-value">${dayData.protein || 0} g</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Weight</div>
            <div class="summary-value">${dayData.weight != null ? dayData.weight + " lbs" : "Not logged"}</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Walk</div>
            <div class="summary-value">${dayData.walk || 0} min</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Medication</div>
            <div class="summary-value">${medsText}</div>
          </div>
        </div>
        <div class="notes-box">
          <strong>Notes:</strong>
          <div class="${dayData.notes ? "" : "notes-empty"}">
            ${dayData.notes ? dayData.notes : "No notes added for today."}
          </div>
        </div>
      `;
    }

    function showPageById(id) {
      pages.forEach(page => page.classList.add("hidden"));
      navTabs.forEach(tab => tab.classList.remove("active"));

      const pageToShow = document.getElementById(id);
      if (pageToShow) {
        pageToShow.classList.remove("hidden");
      }

      navTabs.forEach(tab => {
        if (tab.dataset.target === id) {
          tab.classList.add("active");
        }
      });

      if (id === "progressPage") {
        buildCharts();
      }
    }

    navTabs.forEach(tab => {
      tab.addEventListener("click", () => {
        const targetId = tab.dataset.target;
        showPageById(targetId);
      });
    });

    if (goToProgressBtn) {
      goToProgressBtn.addEventListener("click", () => {
        showPageById("progressPage");
      });
    }

    // Quote of the Day
    const quotes = [
      "You are healing, even on the days it doesn‚Äôt feel like it.",
      "Small steps every day add up to a big transformation.",
      "Your future self is already proud of you.",
      "You didn‚Äôt come this far to only come this far.",
      "Progress, not perfection, is the goal.",
      "Your body deserves your patience and kindness.",
      "One day at a time, one choice at a time."
    ];

    function getQuoteOfTheDay() {
      const today = new Date();
      const startOfYear = new Date(today.getFullYear(), 0, 0);
      const diff = today - startOfYear;
      const oneDayMs = 1000 * 60 * 60 * 24;
      const dayOfYear = Math.floor(diff / oneDayMs);
      const index = dayOfYear % quotes.length;
      return quotes[index];
    }

    function updateQuote() {
      if (!quoteText || !quoteDate) return;
      quoteText.textContent = getQuoteOfTheDay();
      quoteDate.textContent = new Date().toLocaleDateString();
    }

    // Convert stored data to sorted array
    function getSortedDataArray() {
      const allData = loadAllData();
      const dates = Object.keys(allData).sort();
      return dates.map(date => ({
        date,
        ...allData[date]
      }));
    }

    // Build all charts
    function buildCharts() {
      const dataArr = getSortedDataArray();

      const weightPoints = dataArr.filter(d => d.weight != null && !isNaN(Number(d.weight)));
      const waterPoints = dataArr.filter(d => d.water != null && !isNaN(Number(d.water)));
      const proteinPoints = dataArr.filter(d => d.protein != null && !isNaN(Number(d.protein)));
      const walkPoints = dataArr.filter(d => d.walk != null && !isNaN(Number(d.walk)));

      const hasAny =
        weightPoints.length || waterPoints.length || proteinPoints.length || walkPoints.length;

      if (!hasAny) {
        if (weightChart) { weightChart.destroy(); weightChart = null; }
        if (waterChart) { weightChart.destroy(); weightChart = null; }
        if (proteinChart) { proteinChart.destroy(); proteinChart = null; }
        if (walkChart) { walkChart.destroy(); walkChart = null; }
        if (noDataMsg) noDataMsg.style.display = "block";
        return;
      }

      if (noDataMsg) noDataMsg.style.display = "none";

      const ctxWeight = document.getElementById("weightChart").getContext("2d");
      const ctxWater = document.getElementById("waterChart").getContext("2d");
      const ctxProtein = document.getElementById("proteinChart").getContext("2d");
      const ctxWalk = document.getElementById("walkChart").getContext("2d");

      if (weightChart) weightChart.destroy();
      if (waterChart) waterChart.destroy();
      if (proteinChart) proteinChart.destroy();
      if (walkChart) walkChart.destroy();

      if (weightPoints.length) {
        weightChart = new Chart(ctxWeight, {
          type: "line",
          data: {
            labels: weightPoints.map(d => d.date),
            datasets: [
              {
                label: "Weight (lbs)",
                data: weightPoints.map(d => Number(d.weight)),
                borderWidth: 2,
                tension: 0.3
              }
            ]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: true } },
            scales: {
              x: { ticks: { autoSkip: true, maxTicksLimit: 7 } }
            }
          }
        });
      }

      if (waterPoints.length) {
        waterChart = new Chart(ctxWater, {
          type: "line",
          data: {
            labels: waterPoints.map(d => d.date),
            datasets: [
              {
                label: "Water (oz)",
                data: waterPoints.map(d => Number(d.water)),
                borderWidth: 2,
                tension: 0.3
              }
            ]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: true } },
            scales: {
              x: { ticks: { autoSkip: true, maxTicksLimit: 7 } }
            }
          }
        });
      }

      if (proteinPoints.length) {
        proteinChart = new Chart(ctxProtein, {
          type: "line",
          data: {
            labels: proteinPoints.map(d => d.date),
            datasets: [
              {
                label: "Protein (g)",
                data: proteinPoints.map(d => Number(d.protein)),
                borderWidth: 2,
                tension: 0.3
              }
            ]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: true } },
            scales: {
              x: { ticks: { autoSkip: true, maxTicksLimit: 7 } }
            }
          }
        });
      }

      if (walkPoints.length) {
        walkChart = new Chart(ctxWalk, {
          type: "line",
          data: {
            labels: walkPoints.map(d => d.date),
            datasets: [
              {
                label: "Walk (min)",
                data: walkPoints.map(d => Number(d.walk)),
                borderWidth: 2,
                tension: 0.3
              }
            ]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: true } },
            scales: {
              x: { ticks: { autoSkip: true, maxTicksLimit: 7 } }
            }
          }
        });
      }
    }

    // Save / Clear
    saveBtn.addEventListener("click", () => {
      const dateStr = dateInput.value || getTodayString();

      const dayData = {
        water: Number(waterInput.value) || 0,
        protein: Number(proteinInput.value) || 0,
        weight: weightInput.value ? Number(weightInput.value) : null,
        walk: Number(walkInput.value) || 0,
        meds: medsInput.checked,
        notes: notesInput.value.trim()
      };

      const allData = loadAllData();
      allData[dateStr] = dayData;
      saveAllData(allData);
      updateSummary(dayData);
      buildCharts();
      alert("Saved your Bariatric Pal log for " + dateStr);
    });

    clearBtn.addEventListener("click", () => {
      const dateStr = dateInput.value || getTodayString();
      const allData = loadAllData();

      if (allData[dateStr]) {
        if (confirm("Are you sure you want to delete this day's data?")) {
          delete allData[dateStr];
          saveAllData(allData);
          loadDataForDate(dateStr);
          buildCharts();
          alert("Cleared data for " + dateStr);
        }
      } else {
        alert("No data to clear for this date.");
      }
    });

    dateInput.addEventListener("change", () => {
      const dateStr = dateInput.value;
      if (dateStr) {
        loadDataForDate(dateStr);
      }
    });

    // Data export (PDF)
    if (downloadJsonBtn) {
      downloadJsonBtn.addEventListener("click", () => {
        const allData = loadAllData();
        const dates = Object.keys(allData).sort();

        if (!dates.length) {
          alert("No data to export yet.");
          return;
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Title
        doc.setFontSize(16);
        doc.text("Bariatric Pal Progress Report", 105, 12, { align: "center" });

        doc.setFontSize(10);
        let y = 22;

        dates.forEach((date) => {
          const d = allData[date];

          const line = `${date} ‚Äì ` +
            `W: ${d.weight != null ? d.weight : "-"} lbs | ` +
            `Water: ${d.water ?? 0} oz | ` +
            `Protein: ${d.protein ?? 0} g | ` +
            `Walk: ${d.walk ?? 0} min | ` +
            `Meds: ${d.meds ? "Yes" : "No"}`;

          if (y > 280) {
            doc.addPage();
            y = 20;
          }

          doc.text(line, 10, y);
          y += 7;
        });

        doc.save("bariatric-pal-report.pdf");
      });
    }

    (function init() {
      const todayStr = getTodayString();
      dateInput.value = todayStr;
      loadDataForDate(todayStr);
      showPageById("homePage");
      updateQuote();
      buildCharts();
    })();
  </script>
</body>
</html>
